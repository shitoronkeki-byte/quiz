<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>クイズ（JSON外部読込版・6問＆再挑戦ボタン付き）</title>
<style>
  :root{
    --bg:#f6fbff; --card:#ffffff; --ink:#223043;
    --brand1:#7ac8ff; --brand2:#5aa9ff; --accent:#19c37d; --danger:#ff6b6b;
    --ring:#dfe9ff; --shadow:0 18px 50px rgba(20,37,74,.12); --radius:22px;
  }
  html{font-size:66.7%}
  body{margin:0;background:var(--bg);font-family:sans-serif;color:var(--ink)}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
  .quiz{width:100%;max-width:720px;background:var(--card);border-radius:22px;box-shadow:var(--shadow);padding:22px 18px 24px;border:1px solid var(--ring)}
  .bar{height:6px;background:#eef4ff;border-radius:999px;overflow:hidden;margin:0 6px 12px}
  .fill{height:100%;width:0;background:linear-gradient(90deg,var(--brand1),var(--brand2));transition:width .4s ease}
  .hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;padding:0 6px}
  .pill{font-weight:700;background:#eef4ff;border:1px solid var(--ring);padding:6px 9px;border-radius:999px;font-size:0.9rem}
  .q{margin:8px 6px 12px;font-size:1rem;font-weight:700;line-height:1.6;white-space:pre-wrap}
  .opts{display:grid;gap:8px;margin:4px 6px}
  .btn{border:0;cursor:pointer;border-radius:12px;padding:10px;font-weight:700;font-size:0.9rem;text-align:left;
       background:linear-gradient(145deg,#fbfdff,#eef6ff);border:2px solid #e2edff}
  .btn:hover{border-color:#cfe0ff}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
  .result{height:40px;display:flex;align-items:center;justify-content:center;margin-top:8px;font-weight:800;opacity:0;transition:.3s}
  .result.show{opacity:1}
  .ok{color:#0f7a58}
  .ng{color:#a12235}
  .next{display:none;margin:12px auto 0;padding:10px 14px;font-weight:800;color:#fff;border:0;border-radius:12px;
        background:linear-gradient(145deg,var(--brand2),#3c7bff)}
  .next.show{display:block}
  .final{text-align:center;padding:20px}
  .score{font-size:2rem;margin:8px 0;background:linear-gradient(145deg,#3c7bff,#19c37d);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .again-row{display:flex;gap:10px;justify-content:center;margin-top:16px;flex-wrap:wrap}
  .solid,.ghost{font-weight:800;font-size:.95rem;border-radius:12px;padding:10px 14px;border:0;cursor:pointer}
  .solid{color:#fff;background:linear-gradient(145deg,#19c37d,#09a76b)}
  .ghost{background:#eef4ff;color:#2d437a;border:2px solid #d8e5ff}
</style>
</head>
<body>
<div class="wrap">
  <div class="quiz" id="quiz">
    <div class="hdr">
      <div class="pill" id="counter">問題 1 / 0</div>
      <div class="pill" id="scorepill">得点 0</div>
    </div>
    <div class="bar"><div class="fill" id="fill"></div></div>
    <div class="q" id="question"></div>
    <div class="opts" id="options"></div>
    <div class="result" id="result"></div>
    <button class="next" id="next" onclick="nextQuestion()">次へ</button>
  </div>
</div>

<script>
/* ====== 設定 ====== */
const JSON_URL = "https://shitoronkeki-byte.github.io/quiz/questions.json"; // ←あなたの公開URL

/* ====== 状態 ====== */
let allQuestions = [];   // 読み込んだ全問題（6問）
let order = [];          // 出題順の配列（同じセット用に保持）
let idx = 0;             // 現在のインデックス
let score = 0;

/* ====== 初期化（JSON読込） ====== */
async function loadQuestions(){
  try{
    const res = await fetch(JSON_URL, {cache:"no-store"});
    allQuestions = await res.json();
    // 初回は読み込んだ順のまま出題（6問）
    order = allQuestions.map(q=>q);
    idx = 0; score = 0;
    render();
  }catch(e){
    document.getElementById("question").textContent = "問題データを読み込めませんでした。";
    console.error(e);
  }
}

/* ====== 画面描画 ====== */
function render(){
  if(idx >= order.length){ return showFinal(); }

  const q = order[idx];
  document.getElementById("counter").textContent = `問題 ${idx+1} / ${order.length}`;
  document.getElementById("scorepill").textContent = `得点 ${score}`;
  document.getElementById("fill").style.width = ((idx+1)/order.length)*100 + "%";

  // 本文と選択肢
  document.getElementById("question").textContent = q.question;
  const optsEl = document.getElementById("options");
  optsEl.innerHTML = "";
  q.options.forEach(opt=>{
    const b = document.createElement("button");
    b.className = "btn";
    b.textContent = opt;
    b.onclick = ()=>checkAnswer(opt, q.correct);
    optsEl.appendChild(b);
  });

  const resultEl = document.getElementById("result");
  resultEl.className = "result";
  resultEl.textContent = "";

  const nextBtn = document.getElementById("next");
  nextBtn.style.display = "none";
  nextBtn.classList.remove("show");
}

function checkAnswer(chosen, correct){
  const ok = chosen.startsWith(correct);
  if(ok) score++;

  const resultEl = document.getElementById("result");
  resultEl.textContent = ok ? "正解！" : `不正解（正解: ${correct}）`;
  resultEl.className = "result show " + (ok ? "ok" : "ng");

  document.querySelectorAll(".btn").forEach(b=>b.disabled=true);

  const nextBtn = document.getElementById("next");
  nextBtn.textContent = (idx === order.length-1) ? "結果を見る" : "次へ";
  nextBtn.style.display = "block";
  nextBtn.classList.add("show");
}

function nextQuestion(){
  if(idx < order.length-1){ idx++; render(); }
  else{ showFinal(); }
}

/* ====== 結果画面＋再挑戦 ====== */
function showFinal(){
  const total = order.length;
  const percent = Math.round((score/total)*100);
  const container = document.getElementById("quiz");
  container.innerHTML = `
    <div class="final">
      <div class="pill">セット終了</div>
      <div class="score">${score} / ${total}</div>
      <div class="pill">正答率 ${percent}%</div>
      <div class="again-row">
        <button class="solid" onclick="newSet()">新しい問題セット</button>
        <button class="ghost" onclick="sameSet()">同じセットをもう一度</button>
      </div>
    </div>
  `;
}

/* 新しい問題セット＝順番をシャッフルして全6問を再出題 */
function newSet(){
  score = 0; idx = 0;
  order = [...allQuestions];
  shuffle(order);
  restoreShell();
  render();
}

/* 同じセット＝同じ順番のまま全6問を再出題 */
function sameSet(){
  score = 0; idx = 0;
  restoreShell();
  render();
}

/* 殻を再生成（進行バー等を戻す） */
function restoreShell(){
  const wrap = document.querySelector('.wrap');
  wrap.innerHTML = `
    <div class="quiz" id="quiz">
      <div class="hdr">
        <div class="pill" id="counter">問題 1 / ${order.length}</div>
        <div class="pill" id="scorepill">得点 0</div>
      </div>
      <div class="bar"><div class="fill" id="fill"></div></div>
      <div class="q" id="question"></div>
      <div class="opts" id="options"></div>
      <div class="result" id="result"></div>
      <button class="next" id="next" onclick="nextQuestion()">次へ</button>
    </div>
  `;
}

/* フィッシャー–イェーツでシャッフル */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
}

/* 起動 */
loadQuestions();
</script>
</body>
</html>
