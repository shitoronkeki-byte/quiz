<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>クイズ（5問シャッフル／モバイル埋め込み向け・横スクロール防止）</title>
<style>
  :root{
    --bg:#f6fbff; --card:#ffffff; --ink:#223043;
    --brand1:#7ac8ff; --brand2:#5aa9ff; --accent:#19c37d; --danger:#ff6b6b;
    --ring:#dfe9ff; --shadow:0 18px 50px rgba(20,37,74,.12); --radius:22px;
  }
  /* ★ 横スクロール防止＆サイズ計算の安定化 */
  *{ box-sizing:border-box }
  html,body{ margin:0; padding:0; overflow-x:hidden; background:var(--bg); color:var(--ink);
             font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif }
  /* ★ 内部スクロールなし：高さは内容に追従 */
  .wrap{ display:block; padding:12px 10px }
  /* ★ 横幅をやや縮小（max-width:600px） */
  .quiz{ width:100%; max-width:600px; margin:0 auto; background:var(--card); border-radius:22px;
         box-shadow:var(--shadow); padding:18px 14px 20px; border:1px solid var(--ring) }
  .bar{ height:6px; background:#eef4ff; border-radius:999px; overflow:hidden; margin:0 6px 12px }
  .fill{ height:100%; width:0; background:linear-gradient(90deg,var(--brand1),var(--brand2)); transition:width .4s ease }
  /* ★ はみ出し防止のため折返し許可 */
  .hdr{ display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:6px; padding:0 6px; flex-wrap:wrap }
  .pill{ font-weight:700; background:#eef4ff; border:1px solid var(--ring); padding:6px 9px; border-radius:999px; font-size:0.9rem }
  .q{ margin:8px 6px 12px; font-size:1rem; font-weight:700; line-height:1.6; white-space:pre-wrap; word-break:break-word }
  .opts{ display:grid; gap:8px; margin:4px 6px }
  .btn{ border:0; cursor:pointer; border-radius:12px; padding:10px; font-weight:700; font-size:0.9rem; text-align:left;
        background:linear-gradient(145deg,#fbfdff,#eef6ff); border:2px solid #e2edff; word-break:break-word }
  .btn:hover{ border-color:#cfe0ff }
  .btn[disabled]{ opacity:.6; cursor:not-allowed }
  .result{ min-height:38px; display:flex; align-items:center; justify-content:center; margin-top:8px; font-weight:800; opacity:0; transition:.25s }
  .result.show{ opacity:1 }
  .ok{ color:#0f7a58 }
  .ng{ color:#a12235 }
  .next{ display:none; margin:12px auto 0; padding:10px 14px; font-weight:800; color:#fff; border:0; border-radius:12px;
         background:linear-gradient(145deg,var(--brand2),#3c7bff) }
  .next.show{ display:block }
  .final{ text-align:center; padding:16px 10px }
  .score{ font-size:2rem; margin:6px 0; background:linear-gradient(145deg,#3c7bff,#19c37d);
          -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent }
  .again-row{ display:flex; gap:10px; justify-content:center; margin-top:12px; flex-wrap:wrap }
  .solid,.ghost{ font-weight:800; font-size:.95rem; border-radius:12px; padding:10px 14px; border:0; cursor:pointer }
  .solid{ color:#fff; background:linear-gradient(145deg,#19c37d,#09a76b) }
  .ghost{ background:#eef4ff; color:#2d437a; border:2px solid #d8e5ff }
  @media (max-width:520px){
    .q{ font-size:0.95rem }
    .btn{ font-size:0.9rem; padding:10px }
    .pill{ font-size:0.85rem }
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="quiz" id="quiz">
    <div class="hdr">
      <div class="pill" id="counter">問題 1 / 0</div>
      <div class="pill" id="scorepill">得点 0</div>
    </div>
    <div class="bar"><div class="fill" id="fill"></div></div>
    <div class="q" id="question"></div>
    <div class="opts" id="options"></div>
    <div class="result" id="result"></div>
    <button class="next" id="next" onclick="nextQuestion()">次へ</button>
  </div>
</div>

<script>
/* ====== 設定 ====== */
const JSON_URL = "https://shitoronkeki-byte.github.io/quiz/questions.json"; // ←あなたのURL
const PER_SET = 5; // 常に5問

/* ====== 状態 ====== */
let allQuestions = [];
let setQuestions = [];
let idx = 0;
let score = 0;

/* ====== 起動：JSON読込 → 初回セット ====== */
async function loadQuestions(){
  try{
    const res = await fetch(JSON_URL, {cache:"no-store"});
    allQuestions = await res.json();
    newSet(); // 初回は5問ランダム
  }catch(e){
    document.getElementById("question").textContent = "問題データを読み込めませんでした。";
    console.error(e);
  }
}

/* ====== セット生成 ====== */
function newSet(){
  const pool = [...allQuestions];
  shuffle(pool);
  setQuestions = pool.slice(0, Math.min(PER_SET, pool.length));
  shuffle(setQuestions); // 出題順もシャッフル
  idx = 0; score = 0;
  restoreShell();
  render();
}

function sameSet(){
  shuffle(setQuestions); // 同じ5問の順番だけシャッフル
  idx = 0; score = 0;
  restoreShell();
  render();
}

/* ====== 表示 ====== */
function render(){
  if(idx >= setQuestions.length){ return showFinal(); }

  const q = setQuestions[idx];
  byId("counter").textContent = `問題 ${idx+1} / ${setQuestions.length}`;
  byId("scorepill").textContent = `得点 ${score}`;
  byId("fill").style.width = ((idx+1)/setQuestions.length)*100 + "%";

  byId("question").textContent = q.question;
  const optsEl = byId("options");
  optsEl.innerHTML = "";
  q.options.forEach(opt=>{
    const b = document.createElement("button");
    b.className = "btn";
    b.textContent = opt;
    b.onclick = ()=>checkAnswer(opt, q.correct);
    optsEl.appendChild(b);
  });

  const resultEl = byId("result");
  resultEl.className = "result";
  resultEl.textContent = "";

  const nextBtn = byId("next");
  nextBtn.style.display = "none";
  nextBtn.classList.remove("show");
}

function checkAnswer(chosen, correct){
  const ok = chosen.startsWith(correct);
  if(ok) score++;

  const resultEl = byId("result");
  resultEl.textContent = ok ? "正解！" : `不正解（正解: ${correct}）`;
  resultEl.className = "result show " + (ok ? "ok" : "ng");

  document.querySelectorAll(".btn").forEach(b=>b.disabled=true);

  const nextBtn = byId("next");
  nextBtn.textContent = (idx === setQuestions.length-1) ? "結果を見る" : "次へ";
  nextBtn.style.display = "block";
  nextBtn.classList.add("show");
}

function nextQuestion(){
  if(idx < setQuestions.length-1){ idx++; render(); }
  else{ showFinal(); }
}

/* ====== 結果画面（また5問へ） ====== */
function showFinal(){
  const total = setQuestions.length;
  const percent = Math.round((score/total)*100);
  const container = byId("quiz");
  container.innerHTML = `
    <div class="final">
      <div class="pill">セット終了</div>
      <div class="score">${score} / ${total}</div>
      <div class="pill">正答率 ${percent}%</div>
      <div class="again-row">
        <button class="solid" onclick="newSet()">新しい問題セット（5問ランダム）</button>
        <button class="ghost" onclick="sameSet()">同じ5問（順番シャッフル）</button>
      </div>
    </div>
  `;
}

/* ====== 殻再生成（高さは内容に追従） ====== */
function restoreShell(){
  const wrap = document.querySelector('.wrap');
  wrap.innerHTML = `
    <div class="quiz" id="quiz">
      <div class="hdr">
        <div class="pill" id="counter">問題 1 / ${setQuestions.length || PER_SET}</div>
        <div class="pill" id="scorepill">得点 0</div>
      </div>
      <div class="bar"><div class="fill" id="fill"></div></div>
      <div class="q" id="question"></div>
      <div class="opts" id="options"></div>
      <div class="result" id="result"></div>
      <button class="next" id="next" onclick="nextQuestion()">次へ</button>
    </div>
  `;
}

/* ====== ユーティリティ ====== */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
}
function byId(id){ return document.getElementById(id); }

/* 起動 */
loadQuestions();
</script>
</body>
</html>

